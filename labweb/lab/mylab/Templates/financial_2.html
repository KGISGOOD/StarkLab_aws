<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åŸºé‡‘æ¨è–¦å°å¹«æ‰‹</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
        }

        .card-container {
            max-width: 900px;
            margin: 20px auto;
            background-color: #fff;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .selector-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .selector-container select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;

            min-width: 200px;
        }

        .card-container p.intro {
            font-size: 16px;
            color: #34495e;
            margin-top: 10px;
            font-weight: normal;
        }

        .card-container form {
            margin-top: 20px;
        }

        p {
            font-weight: bold;
            margin-top: 20px;
            color: #34495e;
        }

        label {
            display: block;
            margin: 5px 0 10px 20px;
            color: #555;
        }

        button {
            margin-top: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #2980b9;
        }

        #result {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 25px;
            max-width: 900px;
            margin: 20px auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #result h2,
        #result h3 {
            color: #2c3e50;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: #fff;
            border-radius: 6px;
            overflow: hidden;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            font-size: 15px;
        }

        th {
            background-color: #ecf0f1;
        }

        .risk-conservative {
            color: #27ae60;
            font-weight: bold;
        }

        .risk-balanced {
            color: #e67e22;
            font-weight: bold;
        }

        .risk-aggressive {
            color: #e74c3c;
            font-weight: bold;
        }

        .filter-box {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 20px 25px;


            border-radius: 12px;

        }

        .filter-box label {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-box select {
            padding: 10px 14px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #fff;
            min-width: 200px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        }






        @media screen and (max-width: 768px) {

            .card-container,
            #result {
                padding: 15px;
            }

            table,
            thead,
            tbody,
            th,
            td,
            tr {
                font-size: 13px;
            }
        }
    </style>
</head>

<body>
    <h1>åŸºé‡‘æ¨è–¦å°å¹«æ‰‹</h1>

    <div class="card-container">
        <div class="selector-container">

        </div>

        <p class="intro">
            æ‚¨å¥½ï¼Œç‚ºä½¿æœ¬æ¬¡æ‰€æ¨è–¦çš„åŸºé‡‘ç¬¦åˆæ‚¨çš„çš„é¢¨éšªæ‰¿å—åº¦ä»¥åŠæŠ•è³‡åå¥½ï¼Œåœ¨æŠ•è³‡å‰è«‹å¹«å¿™å›ç­”ä»¥ä¸‹å•é¡Œï¼Œè¬è¬!
        </p>

        <form id="questionnaireForm">
            <p>1. ç•¶å¸‚å ´å‡ºç¾æ³¢å‹•æ™‚ï¼Œæ‚¨æœƒå¦‚ä½•åæ‡‰ï¼Ÿ</p>
            <label><input type="radio" name="q1" value="1"> (A) æ“”å¿ƒä¸¦å°‹æ±‚æ¸›å°‘é¢¨éšª </label><br>
            <label><input type="radio" name="q1" value="2"> (B) æ„Ÿåˆ°ä¸å®‰ï¼Œä½†æœƒå …æŒä¸è®Š </label><br>
            <label><input type="radio" name="q1" value="3"> (C) å°‹æ‰¾æ›´å¤šæŠ•è³‡æ©Ÿæœƒ </label><br>

            <p>2. è‹¥æ‚¨çš„æŠ•è³‡æå¤±äº†20%ï¼Œæ‚¨æœƒæ€éº¼åšï¼Ÿ</p>
            <label><input type="radio" name="q2" value="1"> (A) ç«‹å³è³£å‡ºï¼Œä»¥æ¸›å°‘æå¤± </label><br>
            <label><input type="radio" name="q2" value="2"> (B) ä¿æŒä¸è®Šï¼Œç­‰å¾…å¸‚å ´å›å‡ </label><br>
            <label><input type="radio" name="q2" value="3"> (C) è³¼è²·æ›´å¤šï¼Œè¦–ç‚ºé€²å ´çš„å¥½æ©Ÿæœƒ </label><br>

            <p>3. è«‹å•æ‚¨å°é•·æœŸæŠ•è³‡ï¼ˆä¾‹å¦‚5å¹´ä»¥ä¸Šï¼‰çš„æ…‹åº¦å¦‚ä½•ï¼Ÿ</p>
            <label><input type="radio" name="q3" value="1"> (A) ä¸é¡˜æ„æ‰¿æ“”éå¤šé¢¨éšª </label><br>
            <label><input type="radio" name="q3" value="2"> (B) æ¥å—é©åº¦çš„æ³¢å‹•ä¸¦è¿½æ±‚ç©©å®šå›å ± </label><br>
            <label><input type="radio" name="q3" value="3"> (C) ä¸å¤ªåå¥½é•·æœŸæŠ•è³‡ </label><br>

            <p>4. è«‹å•æ‚¨æŠ•è³‡çš„ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ</p>
            <label><input type="radio" name="q4" value="1"> (A) ç©©å®šè³‡é‡‘ </label><br>
            <label><input type="radio" name="q4" value="2"> (B) ææ—©é€€ä¼‘ã€æ•™è‚²åŸºé‡‘ </label><br>
            <label><input type="radio" name="q4" value="3"> (C) é«˜é¢¨éšªå¿«é€Ÿè²¡å¯Œè‡ªç”± </label><br>

            <p>5. è‹¥æœ‰å……è£•è³‡é‡‘ï¼Œæ‚¨æœƒé¸æ“‡å“ªäº›æŠ•è³‡æ¨™çš„ï¼Ÿ</p>
            <label><input type="radio" name="q5" value="1"> (A) ä½é¢¨éšªã€ç©©å®šå›å ± </label><br>
            <label><input type="radio" name="q5" value="2"> (B) ç©©å¥å‹è³‡ç”¢ </label><br>
            <label><input type="radio" name="q5" value="3"> (C) é«˜é¢¨éšªã€é«˜å›å ±è³‡ç”¢ </label><br>

            <p>6. å¯æ¥å—çš„æŠ•è³‡å›å ±ç‡å€é–“ï¼Ÿ</p>
            <label><input type="radio" name="q6" value="1"> (A) -5%è‡³5% </label><br>
            <label><input type="radio" name="q6" value="2"> (B) -15%è‡³15% </label><br>
            <label><input type="radio" name="q6" value="3"> (C) -30%è‡³30% </label><br>

            <p>7. æ˜¯å¦æ›¾ç¶“æ­·éé‡å¤§çš„æŠ•è³‡æå¤±ï¼Ÿ</p>
            <label><input type="radio" name="q7" value="1"> (A) æ˜¯ï¼Œä¸¦ä¸”å°é¢¨éšªæœ‰é¡§æ…® </label><br>
            <label><input type="radio" name="q7" value="2"> (B) æ˜¯ï¼Œä½†ä»é¡˜æ„æŠ•è³‡ </label><br>
            <label><input type="radio" name="q7" value="3"> (C) å°šæœªæœ‰æŠ•è³‡ç¶“é©— </label><br>

            <p>8. æ‚¨åå¥½æŠ•è³‡ä»€éº¼æ¨£çš„è³‡ç”¢ï¼Ÿ</p>
            <label><input type="radio" name="q8" value="1"> (A) åœ‹å‚µã€åœ‹åº«åˆ¸ </label><br>
            <label><input type="radio" name="q8" value="2"> (B) è‚¡ç¥¨èˆ‡å‚µåˆ¸æ··åˆåŸºé‡‘ </label><br>
            <label><input type="radio" name="q8" value="3"> (C) ç§‘æŠ€è‚¡ã€AIæ¦‚å¿µè‚¡ </label><br>

            <p>9. é æœŸçš„æŠ•è³‡æœŸé™ï¼Ÿ</p>
            <label><input type="radio" name="q9" value="1"> (A) å°‘æ–¼1å¹´ </label><br>
            <label><input type="radio" name="q9" value="2"> (B) 1-3å¹´ </label><br>
            <label><input type="radio" name="q9" value="3"> (C) è¶…é5å¹´ </label><br>

            <p>10. æ‚¨çš„æŠ•è³‡ç¶“é©—ï¼Ÿ</p>
            <label><input type="radio" name="q10" value="1"> (A) æ²’æœ‰ç¶“é©— </label><br>
            <label><input type="radio" name="q10" value="2"> (B) æœ‰ä¸€äº›ç¶“é©— </label><br>
            <label><input type="radio" name="q10" value="3"> (C) æœ‰è±å¯Œç¶“é©— </label><br>

            <button type="button" onclick="submitTotalScore()">é€å‡º</button>
        </form>
    </div>
</body>


<div id="result" style="display: none;">
    <h2>æ¨è–¦çµæœ</h2>
    <p><strong>é¢¨éšªç­‰ç´š:</strong> <span id="riskLevel"></span></p>
    <p><strong>ç¸½åˆ†:</strong> <span id="totalScore"></span></p>
    <div id="filterArea" class="filter-box">
        <label for="industrySelect">ğŸ“‚ é¡å‹ï¼š</label>
        <select id="industrySelect">
            <option>è«‹é¸æ“‡é¡å‹</option>
        </select>

        <label for="countrySelect">ğŸŒ ä¸»è¦æŠ•è³‡å€åŸŸï¼š</label>
        <select id="countrySelect">
            <option>è«‹é¸æ“‡ä¸»è¦æŠ•è³‡å€åŸŸ</option>
        </select>
    </div>


    <h3>æ¨è–¦çš„åŸºé‡‘ï¼š</h3>
    <table id="fundTable">
        <thead>
            <tr>
                <th>åŸºé‡‘åç¨±</th>
                <th>é¡å‹</th>
                <th>ä¸»è¦æŠ•è³‡å€åŸŸ</th>
                <th>æ¨™æº–å·®</th>
                <th>å¤æ™®å€¼</th>
                <th>Beta å€¼</th>
                <th>ä¸‰å€‹æœˆå ±é…¬</th>
                <th>ä»Šå¹´ä¾†å ±é…¬ç‡</th>
            </tr>
        </thead>
        <tbody id="fundTableBody"></tbody>
    </table>
</div>
{% load static %}
<script>
    let csvData = [];

    document.addEventListener("DOMContentLoaded", function () {
       fetch("{% static '/åŸºé‡‘è³‡æ–™å½™æ•´1140222.csv' %}")
       // fetch("åŸºé‡‘è³‡æ–™å½™æ•´1140222.csv")
            .then(response => response.text())
            .then(text => {
                parseCSV(text);
                populateDropdowns();
            })
            .catch(error => console.error("ç„¡æ³•è®€å– CSV:", error));
    });


    function parseCSV(text) {
        const lines = text.trim().split("\n");
        const headers = lines[0].split(",");

        const nameIndex = headers.indexOf("æ¨™çš„åç¨±");
        const industryIndex = headers.indexOf("é¡å‹");
        const countryIndex = headers.indexOf("æŠ•è³‡å€åŸŸ");
        const stdDevIndex = headers.indexOf("æ¨™æº–å·®ï¼…");
        const sharpeIndex = headers.indexOf("å¤æ™®å€¼");
        const betaIndex = headers.indexOf("Î²ä¿‚æ•¸");
        const r3mIndex = headers.indexOf("ä¸‰å€‹æœˆï¼…");
        const ytdIndex = headers.indexOf("ä»Šå¹´ä¾†ï¼…");
        const riskIndex = headers.indexOf("é¢¨éšªç­‰ç´š");

        csvData = lines.slice(1).map(line => {
            const columns = line.split(",");
            return {
                name: columns[nameIndex]?.trim(),
                stdDev: parseFloat(columns[stdDevIndex]) || 0,
                sharpe: parseFloat(columns[sharpeIndex]) || 0,
                beta: parseFloat(columns[betaIndex]) || 0,
                r3m: parseFloat(columns[r3mIndex]) || 0,
                rYTD: parseFloat(columns[ytdIndex]) || 0,
                risk: columns[riskIndex]?.trim(),
                industry: columns[industryIndex]?.trim(),
                country: columns[countryIndex]?.trim()
            };
        });

        console.log("CSV è®€å–æˆåŠŸï¼Œå…± " + csvData.length + " ç­†è³‡æ–™ã€‚");
    }

    function populateDropdowns() {
        const industries = [...new Set(csvData.map(d => d.industry).filter(Boolean))].sort();
        const countries = [...new Set(csvData.map(d => d.country).filter(Boolean))].sort();


        const industrySelect = document.getElementById("industrySelect");
        const countrySelect = document.getElementById("countrySelect");

        industrySelect.innerHTML = "<option>è«‹é¸æ“‡é¡å‹</option>" + industries.map(i => `<option>${i}</option>`).join("");
        countrySelect.innerHTML = "<option>è«‹é¸æ“‡ä¸»è¦æŠ•è³‡å€åŸŸ</option>" + countries.map(c => `<option>${c}</option>`).join("");
    }


    function submitTotalScore() {
        let totalScore = 0;
        let allAnswered = true;

        for (let i = 1; i <= 10; i++) {
            const selected = document.querySelector(`input[name="q${i}"]:checked`);
            if (!selected) {
                allAnswered = false;
                break;
            }
            totalScore += parseInt(selected.value);
        }

        if (!allAnswered) {
            alert("è«‹å®Œæˆæ‰€æœ‰å•é¡Œï¼");
            return;
        }

        const riskLevel = determineRiskLevel(totalScore);
       

        

        if (csvData.length === 0) {
            alert("åŸºé‡‘æ•¸æ“šæœªè¼‰å…¥ï¼Œè«‹ç¨å€™å†è©¦ï¼");
            return;
        }

        let recommendations = csvData
            .filter(fund =>
                fund.risk === riskLevel &&
                !isNaN(fund.rYTD)
            )
            .sort((a, b) => b.rYTD - a.rYTD);


        const riskSpan = document.getElementById("riskLevel");
        riskSpan.textContent = riskLevel;
        riskSpan.className = "";

        if (riskLevel === "ä¿å®ˆå‹") riskSpan.classList.add("risk-conservative");
        else if (riskLevel === "ç©©å¥å‹") riskSpan.classList.add("risk-balanced");
        else if (riskLevel === "ç©æ¥µå‹") riskSpan.classList.add("risk-aggressive");

        document.getElementById("totalScore").textContent = totalScore;
        currentRecommendations = recommendations;
        filterByDropdowns();
        document.getElementById("result").style.display = "block";

        const tableBody = document.getElementById("fundTableBody");
        tableBody.innerHTML = recommendations.length > 0
            ? recommendations.map(fund => `
      <tr>
          <td>${fund.name}</td>
          <td>${fund.industry}</td>
          <td>${fund.country}</td>
          <td>${fund.stdDev.toFixed(2)}%</td>
          <td>${fund.sharpe.toFixed(2)}</td>
          <td>${fund.beta.toFixed(2)}</td>
          <td>${fund.r3m.toFixed(2)}%</td>
          <td>${fund.rYTD.toFixed(2)}%</td>
      </tr>
  `).join("")
            : `<tr><td colspan="8">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„åŸºé‡‘</td></tr>`;



        document.getElementById("result").style.display = "block";
    }

    function determineRiskLevel(score) {
        if (score >= 10 && score <= 16) return "ä¿å®ˆå‹";
        if (score >= 17 && score <= 23) return "ç©©å¥å‹";
        if (score >= 24 && score <= 30) return "ç©æ¥µå‹";
        return "æœªçŸ¥";
    }

    document.getElementById("industrySelect").addEventListener("change", filterByDropdowns);
    document.getElementById("countrySelect").addEventListener("change", filterByDropdowns);

    let currentRecommendations = [];  // å„²å­˜æ‰€æœ‰ç¬¦åˆé¢¨éšªå±¬æ€§çš„åŸºé‡‘

    function filterByDropdowns() {
        const selectedIndustry = document.getElementById("industrySelect").value;
        const selectedCountry = document.getElementById("countrySelect").value;

        const filtered = currentRecommendations.filter(fund => {
            return (selectedIndustry === "è«‹é¸æ“‡é¡å‹" || fund.industry === selectedIndustry) &&
                (selectedCountry === "è«‹é¸æ“‡æŠ•è³‡å€åŸŸ" || fund.country === selectedCountry);
        });

        const tableBody = document.getElementById("fundTableBody");
        tableBody.innerHTML = filtered.length > 0
            ? filtered.slice(0, 5).map(fund => `
            <tr>
                <td>${fund.name}</td>
                <td>${fund.industry}</td>
                <td>${fund.country}</td>
                <td>${fund.stdDev.toFixed(2)}%</td>
                <td>${fund.sharpe.toFixed(2)}</td>
                <td>${fund.beta.toFixed(2)}</td>
                <td>${fund.r3m.toFixed(2)}%</td>
                <td>${fund.rYTD.toFixed(2)}%</td>
            </tr>
        `).join("")
            : `<tr><td colspan="8">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„åŸºé‡‘</td></tr>`;
    }


</script>