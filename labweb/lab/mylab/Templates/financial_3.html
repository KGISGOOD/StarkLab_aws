<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åŸºé‡‘æ¨è–¦å°å¹«æ‰‹</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    .card-container {
      max-width: 900px;
      margin: 20px auto;
      background-color: #fff;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .card-container p.intro {
      font-size: 16px;
      color: #34495e;
      margin-top: 10px;
      font-weight: normal;
    }

    .card-container form {
      margin-top: 20px;
    }

    p {
      font-weight: bold;
      margin-top: 20px;
      color: #34495e;
    }

    label {
      display: block;
      margin: 5px 0 10px 20px;
      color: #555;
    }

    button {
      margin-top: 20px;
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2980b9;
    }

    #result {
      background-color: #ffffff;
      border-radius: 10px;
      padding: 25px;
      max-width: 900px;
      margin: 20px auto;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .filter-box {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
      margin: 20px 0;
    }

    .filter-box label {
      font-size: 16px;
      font-weight: bold;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filter-box select {
      padding: 10px 14px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
      min-width: 200px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background-color: #fff;
      border-radius: 6px;
      overflow: hidden;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
      font-size: 15px;
    }

    th {
      background-color: #ecf0f1;
    }

    .risk-conservative {
      color: #27ae60;
      font-weight: bold;
    }

    .risk-balanced {
      color: #e67e22;
      font-weight: bold;
    }

    .risk-aggressive {
      color: #e74c3c;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <h1>åŸºé‡‘æ¨è–¦å°å¹«æ‰‹</h1>

  <div class="card-container">
    <p class="intro">
      æ‚¨å¥½ï¼Œç‚ºä½¿æœ¬æ¬¡æ‰€æ¨è–¦çš„åŸºé‡‘ç¬¦åˆæ‚¨çš„çš„é¢¨éšªæ‰¿å—åº¦ä»¥åŠæŠ•è³‡åå¥½ï¼Œåœ¨æŠ•è³‡å‰è«‹å¹«å¿™å›ç­”ä»¥ä¸‹å•é¡Œï¼Œè¬è¬!
    </p>

    <form id="questionnaireForm">
      <p>1. ç•¶å¸‚å ´å‡ºç¾æ³¢å‹•æ™‚ï¼Œæ‚¨æœƒå¦‚ä½•åæ‡‰ï¼Ÿ</p>
      <label><input type="radio" name="q1" value="1"> (A) æ“”å¿ƒä¸¦å°‹æ±‚æ¸›å°‘é¢¨éšª </label><br>
      <label><input type="radio" name="q1" value="2"> (B) æ„Ÿåˆ°ä¸å®‰ï¼Œä½†æœƒå …æŒä¸è®Š </label><br>
      <label><input type="radio" name="q1" value="3"> (C) å°‹æ‰¾æ›´å¤šæŠ•è³‡æ©Ÿæœƒ </label><br>

      <p>2. è‹¥æ‚¨çš„æŠ•è³‡æå¤±äº†20%ï¼Œæ‚¨æœƒæ€éº¼åšï¼Ÿ</p>
      <label><input type="radio" name="q2" value="1"> (A) ç«‹å³è³£å‡ºï¼Œä»¥æ¸›å°‘æå¤± </label><br>
      <label><input type="radio" name="q2" value="2"> (B) ä¿æŒä¸è®Šï¼Œç­‰å¾…å¸‚å ´å›å‡ </label><br>
      <label><input type="radio" name="q2" value="3"> (C) è³¼è²·æ›´å¤šï¼Œè¦–ç‚ºé€²å ´çš„å¥½æ©Ÿæœƒ </label><br>

      <p>3. è«‹å•æ‚¨å°é•·æœŸæŠ•è³‡ï¼ˆä¾‹å¦‚5å¹´ä»¥ä¸Šï¼‰çš„æ…‹åº¦å¦‚ä½•ï¼Ÿ</p>
      <label><input type="radio" name="q3" value="1"> (A) ä¸é¡˜æ„æ‰¿æ“”éå¤šé¢¨éšª </label><br>
      <label><input type="radio" name="q3" value="2"> (B) æ¥å—é©åº¦çš„æ³¢å‹•ä¸¦è¿½æ±‚ç©©å®šå›å ± </label><br>
      <label><input type="radio" name="q3" value="3"> (C) ä¸å¤ªåå¥½é•·æœŸæŠ•è³‡ </label><br>

      <p>4. è«‹å•æ‚¨æŠ•è³‡çš„ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ</p>
      <label><input type="radio" name="q4" value="1"> (A) ç©©å®šè³‡é‡‘ </label><br>
      <label><input type="radio" name="q4" value="2"> (B) ææ—©é€€ä¼‘ã€æ•™è‚²åŸºé‡‘ </label><br>
      <label><input type="radio" name="q4" value="3"> (C) é«˜é¢¨éšªå¿«é€Ÿè²¡å¯Œè‡ªç”± </label><br>

      <p>5. è‹¥æœ‰å……è£•è³‡é‡‘ï¼Œæ‚¨æœƒé¸æ“‡å“ªäº›æŠ•è³‡æ¨™çš„ï¼Ÿ</p>
      <label><input type="radio" name="q5" value="1"> (A) ä½é¢¨éšªã€ç©©å®šå›å ± </label><br>
      <label><input type="radio" name="q5" value="2"> (B) ç©©å¥å‹è³‡ç”¢ </label><br>
      <label><input type="radio" name="q5" value="3"> (C) é«˜é¢¨éšªã€é«˜å›å ±è³‡ç”¢ </label><br>

      <p>6. å¯æ¥å—çš„æŠ•è³‡å›å ±ç‡å€é–“ï¼Ÿ</p>
      <label><input type="radio" name="q6" value="1"> (A) -5%è‡³5% </label><br>
      <label><input type="radio" name="q6" value="2"> (B) -15%è‡³15% </label><br>
      <label><input type="radio" name="q6" value="3"> (C) -30%è‡³30% </label><br>

      <p>7. æ˜¯å¦æ›¾ç¶“æ­·éé‡å¤§çš„æŠ•è³‡æå¤±ï¼Ÿ</p>
      <label><input type="radio" name="q7" value="1"> (A) æ˜¯ï¼Œä¸¦ä¸”å°é¢¨éšªæœ‰é¡§æ…® </label><br>
      <label><input type="radio" name="q7" value="2"> (B) æ˜¯ï¼Œä½†ä»é¡˜æ„æŠ•è³‡ </label><br>
      <label><input type="radio" name="q7" value="3"> (C) å°šæœªæœ‰æŠ•è³‡ç¶“é©— </label><br>

      <p>8. æ‚¨åå¥½æŠ•è³‡ä»€éº¼æ¨£çš„è³‡ç”¢ï¼Ÿ</p>
      <label><input type="radio" name="q8" value="1"> (A) åœ‹å‚µã€åœ‹åº«åˆ¸ </label><br>
      <label><input type="radio" name="q8" value="2"> (B) è‚¡ç¥¨èˆ‡å‚µåˆ¸æ··åˆåŸºé‡‘ </label><br>
      <label><input type="radio" name="q8" value="3"> (C) ç§‘æŠ€è‚¡ã€AIæ¦‚å¿µè‚¡ </label><br>

      <p>9. é æœŸçš„æŠ•è³‡æœŸé™ï¼Ÿ</p>
      <label><input type="radio" name="q9" value="1"> (A) å°‘æ–¼1å¹´ </label><br>
      <label><input type="radio" name="q9" value="2"> (B) 1-3å¹´ </label><br>
      <label><input type="radio" name="q9" value="3"> (C) è¶…é5å¹´ </label><br>

      <p>10. æ‚¨çš„æŠ•è³‡ç¶“é©—ï¼Ÿ</p>
      <label><input type="radio" name="q10" value="1"> (A) æ²’æœ‰ç¶“é©— </label><br>
      <label><input type="radio" name="q10" value="2"> (B) æœ‰ä¸€äº›ç¶“é©— </label><br>
      <label><input type="radio" name="q10" value="3"> (C) æœ‰è±å¯Œç¶“é©— </label><br>
      <button type="button" onclick="submitTotalScore()">é€å‡º</button>
    </form>
  </div>

  <div id="result" style="display: none;">
    <h2>æ¨è–¦çµæœ</h2>
    <p><strong>é¢¨éšªç­‰ç´š:</strong> <span id="riskLevel"></span></p>
    <p><strong>ç¸½åˆ†:</strong> <span id="totalScore"></span></p>

    <div class="filter-box">
      <label>
        ğŸ“ é¡å‹ï¼š
        <select id="industrySelect">
          <option>è«‹é¸æ“‡é¡å‹</option>
        </select>
      </label>
      <label>
        ğŸŒ ä¸»è¦æŠ•è³‡å€åŸŸï¼š
        <select id="countrySelect">
          <option>è«‹é¸æ“‡ä¸»è¦æŠ•è³‡å€åŸŸ</option>
        </select>
      </label>
    </div>

    <h3>æ¨è–¦çš„åŸºé‡‘ï¼š</h3>
    <table id="fundTable">
      <thead>
        <tr>
          <th>åŸºé‡‘åç¨±</th>
          <th>é¡å‹</th>
          <th>ä¸»è¦æŠ•è³‡å€åŸŸ</th>
          <th>æ¨™æº–å·®</th>
          <th>å¤æ™®å€¼</th>
          <th>Beta å€¼</th>
          <th>ä¸‰å€‹æœˆå ±é…¬</th>
          <th>ä»Šå¹´ä¾†å ±é…¬ç‡</th>
        </tr>
      </thead>
      <tbody id="fundTableBody"></tbody>
    </table>
  </div>

  <div id="chatBox"
    style="display: none; max-width: 900px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 20px;">

    <h3>ğŸ’¬ å•å•AIå°å¹«æ‰‹</h3>
    <div id="chatArea"
      style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fafafa;">
    </div>
    <input type="text" id="chatInput" placeholder="è¼¸å…¥ä½ çš„å•é¡Œ..."
      style="width: 80%; padding: 10px; border-radius: 6px; border: 1px solid #ccc;" />
    <button onclick="sendChat()"
      style="padding: 10px 16px; margin-left: 10px; background-color: #3498db; color: #fff; border: none; border-radius: 6px;">é€å‡º</button>
  </div>

</body>

{% load static %}
<script>
  let csvData = [];
  let currentRecommendations = [];

    document.addEventListener("DOMContentLoaded", function () {
       fetch("{% static '/åŸºé‡‘è³‡æ–™å½™æ•´1140222.csv' %}")
       // fetch("åŸºé‡‘è³‡æ–™å½™æ•´1140222.csv")
            .then(response => response.text())
            .then(text => {
                parseCSV(text);
                populateDropdowns();
            })
            .catch(error => console.error("ç„¡æ³•è®€å– CSV:", error));
    });



  function parseCSV(text) {
    const lines = text.trim().split("\n");
    const headers = lines[0].replace("\ufeff", "").split(",");

    const nameIndex = headers.indexOf("æ¨™çš„åç¨±");
    const industryIndex = headers.indexOf("é¡å‹1");
    const countryIndex = headers.indexOf("æŠ•è³‡å€åŸŸ");
    const stdDevIndex = headers.indexOf("æ¨™æº–å·®ï¼…");
    const sharpeIndex = headers.indexOf("å¤æ™®å€¼");
    const betaIndex = headers.indexOf("Î²ä¿‚æ•¸");
    const r3mIndex = headers.indexOf("ä¸‰å€‹æœˆï¼…");
    const ytdIndex = headers.indexOf("ä»Šå¹´ä¾†ï¼…");

    csvData = lines.slice(1).map(line => {
      const columns = line.split(",");
      return {
        name: columns[nameIndex]?.trim(),
        stdDev: parseFloat(columns[stdDevIndex]) || 0,
        sharpe: parseFloat(columns[sharpeIndex]) || 0,
        beta: parseFloat(columns[betaIndex]) || 0,
        r3m: parseFloat(columns[r3mIndex]) || 0,
        rYTD: parseFloat(columns[ytdIndex]) || 0,
        industry: columns[industryIndex]?.trim(),
        country: columns[countryIndex]?.trim()
      };
    });

  }

  function populateDropdowns() {
    const industries = [...new Set(csvData.map(d => d.industry).filter(Boolean))].sort();
    const countries = [...new Set(csvData.map(d => d.country).filter(Boolean))].sort();

    const industrySelect = document.getElementById("industrySelect");
    const countrySelect = document.getElementById("countrySelect");

    industrySelect.innerHTML = "<option>è«‹é¸æ“‡é¡å‹</option>" + industries.map(i => `<option>${i}</option>`).join("");
    countrySelect.innerHTML = "<option>è«‹é¸æ“‡ä¸»è¦æŠ•è³‡å€åŸŸ</option>" + countries.map(c => `<option>${c}</option>`).join("");
  }

  function submitTotalScore() {
    let totalScore = 0;
    let allAnswered = true;

    for (let i = 1; i <= 10; i++) {
      const selected = document.querySelector(`input[name="q${i}"]:checked`);
      if (!selected) {
        allAnswered = false;
        break;
      }
      totalScore += parseInt(selected.value);
    }

    if (!allAnswered) {
      alert("è«‹å®Œæˆæ‰€æœ‰å•é¡Œï¼");
      return;
    }

    const riskLevel = determineRiskLevel(totalScore);
    document.getElementById("totalScore").textContent = totalScore;

    const riskElem = document.getElementById("riskLevel");
    riskElem.textContent = riskLevel;
    riskElem.className = "";
    if (riskLevel === "ä¿å®ˆå‹") riskElem.classList.add("risk-conservative");
    if (riskLevel === "ç©©å¥å‹") riskElem.classList.add("risk-balanced");
    if (riskLevel === "ç©æ¥µå‹") riskElem.classList.add("risk-aggressive");

    const rawRecommendations = csvData.filter(f =>
      riskLevel === "ä¿å®ˆå‹"
        ? f.stdDev <= 12 && f.sharpe >= 0.35 && f.beta >= 0 && f.beta <= 1 && (f.r3m >= 0 || f.rYTD >= 4)
        : riskLevel === "ç©©å¥å‹"
          ? f.stdDev <= 18 && f.sharpe >= 0.25 && f.beta >= 0.7 && f.beta <= 1.0 && (f.r3m >= -3 || f.rYTD >= 8)
          : riskLevel === "ç©æ¥µå‹"
            ? f.stdDev >= 18 && f.sharpe >= 0.1 && f.beta >= 1.0 && f.beta <= 2.0 && (f.r3m >= -5 || f.rYTD >= 10)
            : false
    );

    // âœ… åŸºé‡‘åç¨±å‰10å­—ç›¸åŒçš„åªä¿ç•™å ±é…¬ç‡æœ€é«˜
    const seen = new Map();
    rawRecommendations.forEach(fund => {
      const key = fund.name.slice(0, 10);
      if (!seen.has(key) || seen.get(key).rYTD < fund.rYTD) {
        seen.set(key, fund);
      }
    });
    currentRecommendations = Array.from(seen.values());

    populateDropdowns();
    filterByDropdowns();
    document.getElementById("result").style.display = "block";
    document.getElementById("chatBox").style.display = "block";

  }

  function determineRiskLevel(score) {
    if (score <= 16) return "ä¿å®ˆå‹";
    if (score <= 23) return "ç©©å¥å‹";
    return "ç©æ¥µå‹";
  }

  function filterByDropdowns() {
    const selectedIndustry = document.getElementById("industrySelect").value;
    const selectedCountry = document.getElementById("countrySelect").value;

    const filtered = currentRecommendations.filter(fund =>
      (selectedIndustry === "è«‹é¸æ“‡é¡å‹" || fund.industry === selectedIndustry) &&
      (selectedCountry === "è«‹é¸æ“‡ä¸»è¦æŠ•è³‡å€åŸŸ" || fund.country === selectedCountry)
    );

    const sorted = filtered.sort((a, b) => b.rYTD - a.rYTD).slice(0, 5);

    const tableBody = document.getElementById("fundTableBody");
    tableBody.innerHTML = sorted.length > 0
      ? sorted.map(f => `
        <tr>
          <td>${f.name}</td>
          <td>${f.industry}</td>
          <td>${f.country}</td>
          <td>${f.stdDev.toFixed(2)}%</td>
          <td>${f.sharpe.toFixed(2)}</td>
          <td>${f.beta.toFixed(2)}</td>
          <td>${f.r3m.toFixed(2)}%</td>
          <td>${f.rYTD.toFixed(2)}%</td>
        </tr>
      `).join("")
      : `<tr><td colspan="8">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„åŸºé‡‘</td></tr>`;
  }

  // ç¶å®šé¸å–®è®Šæ›´äº‹ä»¶
  document.addEventListener("change", function (e) {
    if (e.target.id === "industrySelect" || e.target.id === "countrySelect") {
      filterByDropdowns();
    }
  });




  const contextPrompt = `
å…§å®¹çµæ§‹ï¼š
é–‹é ­
ç°¡è¦èªªæ˜æœ¬æ¬¡åˆ†ææ˜¯æ ¹æ“šå•å·çµæœé€²è¡Œçš„å€‹äººåŒ–å»ºè­°ã€‚
ç”¨èªæº«å’Œå°ˆæ¥­ï¼Œå»ºç«‹å®¢æˆ¶ä¿¡ä»»æ„Ÿã€‚
å®¢æˆ¶é¢¨éšªåˆ†æ
æ¸…æ¥šåˆ—å‡ºå®¢æˆ¶çš„ï¼š
ã€Œç¸½å¾—åˆ†ã€
ã€Œé¢¨éšªå±¬æ€§ã€ï¼ˆä¿å®ˆå‹ / ç©©å¥å‹ / ç©æ¥µå‹ï¼‰
è§£é‡‹é€™å€‹é¢¨éšªå±¬æ€§ä»£è¡¨çš„æŠ•è³‡æ€§æ ¼ï¼Œä¾‹å¦‚æ‰¿å—æ³¢å‹•èƒ½åŠ›ã€å ±é…¬æœŸå¾…ã€æŠ•è³‡å¿ƒæ…‹ç‰¹æ€§ã€‚
æ¨è–¦åŸºé‡‘åˆ—è¡¨ï¼ˆ5æª”ï¼‰ æ¯ä¸€æª”åŸºé‡‘éœ€ä¾ç…§ä¸‹åˆ—æ–¹å¼æ’°å¯«ä¸€å°æ®µæ–‡å­—ï¼š
åŸºé‡‘åç¨±ã€‚
æŠ•è³‡æ¨™çš„æˆ–ç­–ç•¥æ¦‚è¿°ï¼ˆä¾‹å¦‚ï¼šä¸»è¦æŠ•è³‡æ–¼ç¾åœ‹ç§‘æŠ€è‚¡ã€åˆ†æ•£æ–¼å…¨çƒæ”¿åºœå…¬å‚µç­‰ï¼‰ã€‚
é©åº¦è½‰è­¯é—œéµæ•¸æ“šæŒ‡æ¨™ï¼ˆå¦‚æ¨™æº–å·®ã€å¤æ™®å€¼ã€Î²å€¼ï¼‰æˆæ˜“æ‡‚çš„èªªæ˜ï¼Œé€£çµåˆ°å®¢æˆ¶çš„é¢¨éšªå±¬æ€§ã€‚
èªªæ˜ç‚ºä»€éº¼é€™æª”åŸºé‡‘é©åˆå®¢æˆ¶çš„æŠ•è³‡åå¥½èˆ‡ç›®æ¨™ã€‚
å±•æœ›ã€‚
ï¼ˆâš¡ç¦æ­¢å–®ç´”åˆ—å‡ºæ•¸å­—ï¼Œè¦è§£é‡‹æ•¸å­—èƒŒå¾Œçš„æ„ç¾©ï¼ï¼‰
æ•´é«”ç¸½çµ
æ¦‚è¿°é€™çµ„åŸºé‡‘é…ç½®çš„é‚è¼¯ï¼ˆä¾‹å¦‚ï¼šç©©å®šæ”¶ç›Šæ­é…æˆé•·æ½›åŠ›ï¼ç©æ¥µå‹æ­é…åˆ†æ•£é¢¨éšªç­–ç•¥ï¼‰ã€‚
ç”¨æº«å’Œçš„å£å»æé†’å®¢æˆ¶ï¼šã€ŒæŠ•è³‡éœ€å®šæœŸæª¢è¦–ï¼Œéš¨è‘—å¸‚å ´è®Šå‹•æˆ–äººç”Ÿç›®æ¨™èª¿æ•´è³‡ç”¢é…ç½®ã€ã€‚
é¼“å‹µå®¢æˆ¶å¯èˆ‡è²¡å¯Œç®¡ç†é¡§å•æŒçºŒåˆä½œï¼ŒæŒæ¡æœ€ä½³å¸ƒå±€ã€‚
è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”æ‰€æœ‰å•é¡Œã€‚
`;

  async function getAIResponse(message) {
    const fundSnippets = csvData.slice(0, 100).map(f =>

      `åŸºé‡‘åç¨±ï¼š${f.name}ï¼Œé¡å‹ï¼š${f.industry}ï¼Œåœ°å€ï¼š${f.country}ï¼Œæ¨™æº–å·®ï¼š${f.stdDev}%ï¼Œå¤æ™®å€¼ï¼š${f.sharpe}ï¼ŒBetaï¼š${f.beta}ï¼Œä»Šå¹´ä¾†å ±é…¬ç‡ï¼š${f.rYTD}%`
    ).join("\n");

    const riskText = document.getElementById("riskLevel").textContent || "æœªæä¾›";
    const fullPrompt = `${contextPrompt}

ä½¿ç”¨è€…é¢¨éšªå±¬æ€§ç‚ºï¼šã€Œ${riskText}ã€


ç›®å‰æ¨è–¦åŸºé‡‘å¦‚ä¸‹ï¼š
${fundSnippets || "ï¼ˆç›®å‰å°šæœªæœ‰æ¨è–¦è³‡æ–™ï¼‰"}

ä½¿ç”¨è€…æå•ï¼š
${message}
`;

    const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": "Bearer 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",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "llama3-8b-8192",
        messages: [
          {
            role: "system",
            content: `ä½ æ˜¯ä¸€ä½ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€å£å»å°ˆæ¥­æº«å’Œçš„è²¡å¯Œé¡§å•ï¼Œè«‹å§‹çµ‚ç”¨ç¹é«”ä¸­æ–‡å›ç­”æ‰€æœ‰å•é¡Œï¼Œä¸å¯ä½¿ç”¨è‹±æ–‡ã€‚\n\n${contextPrompt}`
          },
          {
            role: "user",
            content: `ä»¥ä¸‹æ˜¯ä½¿ç”¨è€…çš„å•é¡Œï¼Œè«‹ç”¨ç¹é«”ä¸­æ–‡å®Œæ•´å›ç­”ï¼š\n${message}`
          }
        ]
        ,

        temperature: 0.5
      })
    });

    const data = await response.json();

    if (!data.choices || !data.choices[0] || !data.choices[0].message) {
      console.error("Groq å›å‚³å…§å®¹ï¼š", data);
      throw new Error("AI å›å‚³æ ¼å¼éŒ¯èª¤ï¼Œä¼ºæœå™¨è¨Šæ¯ï¼š" + (data.error?.message || "ä¸æ˜éŒ¯èª¤"));
    }
    return data.choices[0].message.content.trim();
  }



  async function sendChat() {
    const chatInput = document.getElementById("chatInput");
    const chatArea = document.getElementById("chatArea");
    const userText = chatInput.value.trim();

    if (currentRecommendations.length === 0) {
      alert("âš ï¸ è«‹å…ˆå®Œæˆå•å·ä¸¦ç”¢ç”Ÿæ¨è–¦çµæœï¼Œå†é€²è¡Œæå•ï¼");
      return;
    }


    if (!userText) return;

    chatArea.innerHTML += `<div><strong>ä½ ï¼š</strong>${userText}</div>`;
    chatArea.innerHTML += `<div id="loading">AIï¼š<em>æ­£åœ¨æ€è€ƒä¸­...</em></div>`;
    chatInput.value = "";

    try {
      const aiReply = await getAIResponse(userText);
      document.getElementById("loading")?.remove();
      chatArea.innerHTML += `<div><strong>AIï¼š</strong>${aiReply.replace(/\n/g, "<br>")}</div>`;
    } catch (err) {
      chatArea.innerHTML += `<div><strong>AIï¼š</strong>âš ï¸ éŒ¯èª¤ï¼š${err.message}</div>`;

      console.error("âŒ Groq éŒ¯èª¤è¨Šæ¯ï¼š", err);
    }

    chatArea.scrollTop = chatArea.scrollHeight;
  }



</script>




</body>

</html>